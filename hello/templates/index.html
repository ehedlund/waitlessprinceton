<html>
	<!-- navbar -->
	<head>
		<title> waitLess </title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
		<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<style type="text/css">
		    .jumbotron {
		        background: #532f8c;
		        color: white;
		        padding-bottom: 80px
		    }
		    .jumbotron .btn-primary {
		        background: #845ac7;
		        border-color: #845ac7
		    }
		    .jumbotron .btn-primary:hover {
		        background: #7646c1
		    }
		    .jumbotron p {
		        color: #d9ccee;
		        max-width: 75%;
		        margin: 1em auto 2em
		    }
		    .navbar+.jumbotron {
		        margin-top: -20px
		    }
		    .jumbotron .lang-logo {
		        display: block;
		        background: #b01302;
		        border-radius: 50%;
		        overflow: hidden;
		        width: 100px;
		        height: 100px;
		        margin: auto;
		        border: 2px solid white
		    }
		    .jumbotron .lang-logo img {
		        max-width: 100%
		    }
		</style>
	</head>

	<body>
		<nav class="navbar navbar-default navbar-static-top navbar-inverse">
			<div class="container">
				<ul class="nav navbar-nav">
					<li class="active">
						<a href="/"><span class="glyphicon glyphicon-home"></span> waitLess </a>
					</li>
					<li>
						<a href="https://waitlessprinceton.herokuapp.com/about"><span class="glyphicon glyphicon-info-sign"></span> About </a>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li class="navbar-right">
						<a href="https://waitlessprinceton.herokuapp.com/accounts/logout/"><span class="glyphicon glyphicon-book"></span> Logout</a>
					</li>
				</ul>
			</div>
		</nav>
	</body>

	<head>
		<!-- icon links for mobile -->
		<link rel="apple-touch-icon" sizes="57x57" href="/static/hello/apple-icon-57x57.png" />
		<link rel="apple-touch-icon" sizes="72x72" href="/static/hello/apple-icon-72x72.png" />
		<link rel="apple-touch-icon" sizes="114x114" href="/static/hello/apple-icon-114x114.png" />
		<link rel="apple-touch-icon" sizes="144x144" href="/static/hello/apple-icon-144x144.png" />
		
		<!-- leaflet includes -->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
		<link rel="stylesheet" href="//code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" type="text/css">
		<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
		
		<!-- chart generation script -->
	    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	    <script> function drawChart(elem, name) {
			    return 0;
		    }
		</script>
	    <script type="text/javascript"> 
	    	google.charts.load('current', {'packages':['corechart']});
	    	google.charts.setOnLoadCallback(drawChart);
	    </script>

		<!-- hover box and legend -->
		<style media="screen" type="text/css">
			.info {
				padding:6px 8px;
				font: 14px/16px Arial, Helvetica, sans-serif;
				background: white;
				background: rgba(255,255,255,0.8);
				box-shadow: 0 0 15px rgba(0,0,0,0.2);
				border-radius: 5px;
			}
			.info h4 {
				margin: 0 0 5px;
				color: #777;
			}
			.legend {
				line-height: 18px;
				color: #555;
			}
			.legend i {
				width: 18px;
				height: 18px;
				float: left;
				margin-right: 8px;
				opacity: 0.7;
			}
		</style>
	</head>
	
	<!-- map -->
	<body>
		<div id="mapid"></div>
		<!-- map positioning -->
		<style>
		#mapid {
			position: absolute;
			top: 50; right: 0; bottom: 0; left: 0;
		}
		</style>
		
		<script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
    	<script src="//code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    	<script src="../static/hello/SliderControl.js"></script>
		
		<script>
			// popup variables
			var popupId = 1;
	 		var chartId = "curve_chart" + popupId;

	 		// get json from views
			{% block content %}
				var jsTraffic = {{ jsonTraffic }};
			{% endblock %}
			
			// time rounding function
			function getNearestHalfHourTimeString() {
				var now = new Date();
				var hour = now.getHours();
				var minutes = now.getMinutes();
				var ampm = "AM";
				if (minutes < 15) {
				minutes = "00";
				} else if (minutes < 45){
				minutes = "30";
				} else {
				minutes = "00";
				++hour;
				}
				return("T" + hour + minutes);
			}

			// traffic generating function
			function getTrafficAtTime(givenTime) {
				var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
				var currentDay = days[(new Date()).getDay()];
				var buildings = ["AtriumCafe", "ButlerWilsonCollege", "CenterforJewishLife", "ChancellorGreen", "ChemistryCafe", "ForbesCollege", "FristGallery", "GraduateCollege", "RockefellerMatheyCollege", "Studio34ButlerEmporium", "WhitmanCollege", "WoodrowWilsonCafe", "FirestoneLibrary", "DillonGym"];
				var traffics = [];

				for (i = 0; i < 14; i++) {
					// get building
					var b = buildings[i];
					// get day
					var d = jsTraffic[b][currentDay];
					var t;
					if (typeof(d) == 'undefined') {
						t = 0;
					}
					else {
						// get time
						t = jsTraffic[b][currentDay][givenTime];
						if (typeof(t) == 'undefined') {
							t = 0;
						}
					}
					traffics[i] = t;
				}

				var atrium = traffics[0];
				var butwil = traffics[1];
				var cjl = traffics[2];
				var chancgreen = traffics[3];
				var chem = traffics[4];
				var forbes = traffics[5];
				var frist = traffics[6];
				var grad = traffics[7];
				var roma = traffics[8];
				var studio = traffics[9];
				var whitman = traffics[10];
				var woodywoo = traffics[11];
				var firestone = traffics[12];
				var dillon = traffics[13];

	        	// put traffic into json file
			var time = givenTime.substring(1, 3) + ":" + givenTime.substring(3);
      			var data = {"type":"FeatureCollection","generator":"overpass-turbo","copyright":"The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.","timestamp":"2017-04-08T16:21:02Z","features":[{"type":"Feature","id":"way/40718011","properties":{"@id":"way/40718011","building":"university","name":"Atrium Cafe","queryname":"AtriumCafe","density":atrium,"lat":40.349218,"long":-74.654943,"max":150,"time":time,"hours":{0:"CLOSED",1:"08:00-16:00",2:"08:00-16:00",3:"08:00-16:00",4:"08:00-16:00",5:"08:00-15:00",6:"CLOSED"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6545127,40.3491739],[-74.6547835,40.3495186],[-74.6548459,40.3495548],[-74.6548576,40.3495689],[-74.6549258,40.349536],[-74.6549442,40.3495582],[-74.654916,40.3495718],[-74.6549749,40.3496427],[-74.6549988,40.3496571],[-74.6550304,40.3496612],[-74.6550821,40.3496371],[-74.6550064,40.3495428],[-74.655034,40.3495299],[-74.6550124,40.349503],[-74.6550646,40.3494787],[-74.6550184,40.3494211],[-74.6551926,40.3493401],[-74.6553498,40.3495363],[-74.6555131,40.3494603],[-74.6554205,40.3493447],[-74.655621,40.3492514],[-74.6556655,40.349307],[-74.655621,40.3493277],[-74.6556895,40.3494133],[-74.6559665,40.3492846],[-74.6559049,40.3492077],[-74.6558052,40.349254],[-74.6557405,40.3491732],[-74.6557407,40.3491565],[-74.6557229,40.3491355],[-74.6557054,40.3491305],[-74.6555699,40.3489573],[-74.6555681,40.3489394],[-74.6555501,40.3489139],[-74.6555316,40.3489093],[-74.6554666,40.3488284],[-74.6555684,40.348781],[-74.6555083,40.3487062],[-74.6552354,40.3488334],[-74.6552978,40.3489112],[-74.6553439,40.3488897],[-74.6553953,40.3489538],[-74.6551802,40.3490541],[-74.6550858,40.3489364],[-74.654947,40.3490011],[-74.6549303,40.3489802],[-74.6545127,40.3491739]]]}},{"type":"Feature","id":"way/141450295","properties":{"@id":"way/141450295","building":"dormitory","name":"Butler/Wilson College","queryname":"ButlerWilsonCollege","density":butwil,"lat":40.344702,"long":-74.656507,"max":570,"time":time,"hours":{0:"10:00-14:00, 17:00-20:00",1:"08:00-11:00, 11:30-14:00, 17:00-20:00",2:"08:00-11:00, 11:30-14:00, 17:00-20:00",3:"08:00-11:00, 11:30-14:00, 17:00-20:00",4:"08:00-11:00, 11:30-14:00, 17:00-20:00",5:"08:00-11:00, 11:30-14:00, 17:00-20:00",6:"10:00-14:00, 17:00-20:00"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6562698,40.3446579],[-74.6562379,40.344616],[-74.6563492,40.3445649],[-74.6563479,40.3445557],[-74.6563532,40.3445465],[-74.6563626,40.3445353],[-74.6563841,40.3445322],[-74.6564042,40.3445342],[-74.6564243,40.3445393],[-74.6564405,40.3445304],[-74.6566992,40.3448613],[-74.65671,40.344892],[-74.6566939,40.3449104],[-74.6566644,40.3449124],[-74.6566337,40.3449063],[-74.6566054,40.344892],[-74.6565786,40.3448756],[-74.6565584,40.3448576],[-74.6565296,40.3448315],[-74.6564552,40.3447979],[-74.656431,40.3447642],[-74.6563685,40.3447875],[-74.6563548,40.3447695],[-74.6562111,40.3448327],[-74.6564203,40.3451046],[-74.6562889,40.3451618],[-74.6560957,40.3449124],[-74.6558302,40.3450269],[-74.6558061,40.3449962],[-74.6557122,40.3450392],[-74.6556478,40.3449615],[-74.6557417,40.3449206],[-74.6557229,40.3448981],[-74.6560019,40.3447693],[-74.6559689,40.3447226],[-74.6560904,40.3446692],[-74.6561333,40.3447162],[-74.6562698,40.3446579]]]}},{"type":"Feature","id":"way/148099033","properties":{"@id":"way/148099033","building":"university","name":"Center for Jewish Life","queryname":"CenterforJewishLife","operator":"Princeton University","density":cjl,"lat":40.346706,"long":-74.653625,"max":91,"time":time,"hours":{0:"11:30-13:30, 17:30-19:00",1:"08:00-09:00, 11:30-13:30, 17:30-19:30",2:"08:00-09:00, 11:30-13:30, 17:30-19:30",3:"08:00-09:00, 11:30-13:30, 17:30-19:30",4:"08:00-09:00, 11:30-13:30, 17:30-19:30",5:"08:00-09:00, 11:30-13:30, 19:30-21:00",6:"11:30-13:30, 19:30-21:00"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6538162,40.3466198],[-74.6538616,40.3465647],[-74.6538484,40.3465156],[-74.6537921,40.3464931],[-74.6537304,40.3465074],[-74.6536875,40.3465565],[-74.6535281,40.3466183],[-74.65354,40.3466362],[-74.6534541,40.3466403],[-74.6533884,40.3466064],[-74.65334,40.346661],[-74.6533871,40.3466853],[-74.6533949,40.346714],[-74.6535135,40.3468753],[-74.6536473,40.3468181],[-74.6536363,40.3467814],[-74.6537414,40.3467371],[-74.6537543,40.3467549],[-74.6538195,40.3467662],[-74.6538321,40.3467242],[-74.6538149,40.3467007],[-74.6538612,40.3466811],[-74.6538312,40.34664],[-74.6538162,40.3466198]]]}},{"type":"Feature","id":"way/141230075","properties":{"@id":"way/141230075","building":"university","name":"Chancellor Green","queryname":"ChancellorGreen","density":chancgreen,"lat":40.349052,"long":-74.658600,"max":149,"time":time,"hours":{0:"CLOSED",1:"08:00-17:00",2:"08:00-17:00",3:"08:00-17:00",4:"08:00-17:00",5:"08:00-15:00",6:"10:00-14:00, 17:00-20:00"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6584514,40.3490694],[-74.6584572,40.3490803],[-74.6583997,40.3490979],[-74.6583864,40.3490728],[-74.658353,40.349061],[-74.6583169,40.3490712],[-74.6582984,40.3490979],[-74.6583378,40.3491824],[-74.6583717,40.349197],[-74.6584143,40.3491859],[-74.6584259,40.3491591],[-74.6584177,40.3491384],[-74.6584771,40.3491247],[-74.658484,40.349142],[-74.6585745,40.3491782],[-74.6586773,40.3491535],[-74.6587308,40.3490774],[-74.6587859,40.3490635],[-74.6588184,40.3490815],[-74.6588666,40.3490695],[-74.6588723,40.3490401],[-74.6588393,40.3489624],[-74.6588031,40.3489438],[-74.6587638,40.3489551],[-74.6587488,40.3489821],[-74.6587551,40.3489961],[-74.658689,40.3490133],[-74.6586844,40.349003],[-74.6586,40.3489711],[-74.658509,40.3489932],[-74.6584514,40.3490694]]]}},{"type":"Feature","id":"way/59268697","properties":{"@id":"way/59268697","building":"university","name":"Chemistry Cafe","queryname":"ChemistryCafe","operator":"Princeton University","density":chem,"lat":40.344027,"long":-74.650709,"max":350,"time":time,"hours":{0:"CLOSED",1:"08:00-15:00",2:"08:00-15:00",3:"08:00-15:00",4:"08:00-15:00",5:"08:00-14:00",6:"CLOSED"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6508904,40.3446159],[-74.6513199,40.3444213],[-74.6506042,40.343504],[-74.65049,40.3435557],[-74.6504239,40.343471],[-74.6501086,40.3436139],[-74.6508904,40.3446159]]]}},{"type":"Feature","id":"way/302942852","properties":{"@id":"way/302942852","building":"dormitory","name":"Forbes College","queryname":"ForbesCollege","density":forbes,"lat":40.341876,"long":-74.660979,"max":277,"time":time,"hours":{0:"10:00-14:00, 17:00-20:00",1:"08:00-11:00, 11:30-14:00, 17:00-20:00",2:"08:00-11:00, 11:30-14:00, 17:00-20:00",3:"08:00-11:00, 11:30-14:00, 17:00-20:00",4:"08:00-11:00, 11:30-14:00, 17:00-20:00",5:"08:00-11:00, 11:30-14:00, 17:00-20:00",6:"10:00-14:00, 17:00-20:00"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6610921,40.3426902],[-74.6611833,40.3428047],[-74.6615481,40.3426371],[-74.6616237,40.3426029],[-74.6617511,40.3424343],[-74.6616661,40.3423917],[-74.6616715,40.3423508],[-74.6613818,40.3422404],[-74.6613442,40.3421791],[-74.6614301,40.3421178],[-74.6607595,40.3412387],[-74.6601265,40.3415127],[-74.6603196,40.3417498],[-74.6603733,40.3417253],[-74.66036,40.3417073],[-74.660405,40.3416894],[-74.6603848,40.3416577],[-74.6604016,40.3416515],[-74.6603594,40.3415892],[-74.6603369,40.3415979],[-74.6603171,40.3415713],[-74.6602767,40.3415863],[-74.6602553,40.3415576],[-74.6607542,40.3413532],[-74.6607825,40.3413929],[-74.6607376,40.3414149],[-74.6608361,40.3415396],[-74.6607825,40.3415631],[-74.6607689,40.3415484],[-74.6606779,40.3415866],[-74.6606911,40.3416057],[-74.6605947,40.3416444],[-74.6605812,40.3416261],[-74.6605034,40.3416609],[-74.6605183,40.3416812],[-74.6604846,40.3416936],[-74.6605034,40.3417222],[-74.6604734,40.3417343],[-74.6605141,40.3417835],[-74.6608494,40.3416404],[-74.6608977,40.3417079],[-74.660777,40.3417631],[-74.6607966,40.3417946],[-74.6607367,40.3418224],[-74.6607476,40.3418412],[-74.6606911,40.3418674],[-74.660702,40.3418836],[-74.6606455,40.3419082],[-74.6606804,40.3419573],[-74.6607448,40.3419369],[-74.660793,40.3420064],[-74.660836,40.3420064],[-74.6608628,40.3420105],[-74.6609003,40.3420186],[-74.660952,40.3420406],[-74.6610083,40.342014],[-74.6611808,40.3422398],[-74.6612227,40.3422288],[-74.6612763,40.3423147],[-74.6615808,40.3424506],[-74.6610921,40.3426902]]]}},{"type":"Feature","id":"way/27341386","properties":{"@id":"way/27341386","building":"university","name":"Frist Gallery","queryname":"FristGallery","operator":"Princeton University","wheelchair":"yes","density":frist,"lat":40.346740,"long":-74.655142,"max":493,"time":time,"hours":{0:"00:00-03:00, 12:00-19:00",1:"07:00-22:00",2:"07:00-22:00",3:"07:00-22:00",4:"07:00-23:59",5:"00:00-03:00, 07:00-19:00",6:"08:00-19:00, 23:00-23:59"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6555801,40.3466183],[-74.6555912,40.34661],[-74.6555745,40.3465888],[-74.6556126,40.3465716],[-74.6555918,40.346545],[-74.6555533,40.3465617],[-74.6555253,40.3465258],[-74.6555092,40.3465304],[-74.6554264,40.3464243],[-74.6554052,40.3464331],[-74.6553859,40.3464083],[-74.6554514,40.3463783],[-74.6554278,40.3463492],[-74.6553492,40.3463847],[-74.6553387,40.3463713],[-74.6552991,40.3463903],[-74.6552791,40.3463669],[-74.6551691,40.3464192],[-74.6551557,40.3464006],[-74.6547558,40.3465817],[-74.6547692,40.3465995],[-74.6546161,40.3466699],[-74.6546423,40.3467011],[-74.6546249,40.3467101],[-74.6546502,40.3467429],[-74.6546924,40.3467264],[-74.6547093,40.3467487],[-74.6546588,40.346772],[-74.6547516,40.3468911],[-74.6547384,40.3468974],[-74.6547997,40.3469757],[-74.6548139,40.3469709],[-74.6549539,40.3471505],[-74.6550948,40.3470867],[-74.6550851,40.3470742],[-74.6551022,40.3470674],[-74.6551113,40.347045],[-74.6551035,40.3470352],[-74.6552664,40.3469614],[-74.6552794,40.3469783],[-74.6553676,40.3469385],[-74.6553536,40.3469219],[-74.6555104,40.3468509],[-74.6555185,40.346859],[-74.6555435,40.3468654],[-74.6555603,40.34686],[-74.6555697,40.3468721],[-74.6557219,40.3468031],[-74.6555801,40.3466183]]]}},{"type":"Feature","id":"way/27341764","properties":{"@id":"way/27341764","addr:city":"Princeton","addr:housenumber":"88","addr:postcode":"08540","addr:street":"College Road West","building":"dormitory","building:levels":"4","name":"Graduate College","queryname":"GraduateCollege","density":grad,"lat":40.340368,"long":-74.665506,"max":262,"time":time,"smoking":"outside","hours":{0:"11:00-14:00",1:"07:30-09:30, 17:00-20:00",2:"07:30-09:30, 17:00-20:00",3:"07:30-09:30, 17:00-20:00",4:"07:30-09:30, 17:00-20:00",5:"07:30-09:30, 17:00-20:00",6:"CLOSED"},"@relations":[{"role":"outer","rel":34377,"reltags":{"addr:city":"Princeton","addr:housenumber":"88","addr:postcode":"08540","addr:street":"College Road West","building":"dormitory","building:levels":"3","smoking":"outside","type":"multipolygon"}}]},"geometry":{"type":"Polygon","coordinates":[[[-74.6646529,40.3405139],[-74.6646272,40.3404746],[-74.6645156,40.3405139],[-74.6645843,40.3406513],[-74.6646873,40.3406317],[-74.6647559,40.3408279],[-74.6648675,40.3411354],[-74.6648074,40.3411485],[-74.6649276,40.341456],[-74.6648847,40.3414625],[-74.6649104,40.341541],[-74.6655113,40.3414232],[-74.6653396,40.3410111],[-74.6655885,40.3409457],[-74.6655542,40.3408672],[-74.6655198,40.3408737],[-74.6654598,40.3407298],[-74.6655027,40.3407167],[-74.6654769,40.3406709],[-74.6656572,40.3406251],[-74.6655027,40.3403634],[-74.6655885,40.3403373],[-74.6655284,40.3402391],[-74.6651336,40.3403569],[-74.665125,40.3403307],[-74.6650478,40.3403569],[-74.6650564,40.3403765],[-74.6646529,40.3405139]]]}},{"type":"Feature","id":"way/141297740","properties":{"@id":"way/141297740","building":"dormitory","name":"Rockefeller/Mathey College","queryname":"RockefellerMatheyCollege","density":roma,"lat":40.348595,"long":-74.662204,"max":474,"time":time,"hours":{0:"10:00-14:00, 17:00-20:00",1:"08:00-11:00, 11:30-14:00, 17:00-20:00",2:"08:00-11:00, 11:30-14:00, 17:00-20:00",3:"08:00-11:00, 11:30-14:00, 17:00-20:00",4:"08:00-11:00, 11:30-14:00, 17:00-20:00",5:"08:00-11:00, 11:30-14:00, 17:00-20:00",6:"10:00-14:00, 17:00-20:00"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6618899,40.3485553],[-74.6619794,40.3487358],[-74.6619428,40.3487456],[-74.6619604,40.3487801],[-74.6619866,40.3488313],[-74.6620639,40.3488093],[-74.6620793,40.3488353],[-74.6621866,40.3488057],[-74.6621598,40.3487577],[-74.6622302,40.3487393],[-74.6622262,40.348728],[-74.662259,40.3487188],[-74.6622738,40.3487434],[-74.6627639,40.3486023],[-74.6627559,40.3485854],[-74.662839,40.3485604],[-74.6628075,40.3485047],[-74.6627264,40.3485323],[-74.6627143,40.348517],[-74.6624273,40.3486038],[-74.6623938,40.3485405],[-74.6625467,40.3484914],[-74.662661,40.3484417],[-74.6624568,40.3481689],[-74.6624287,40.3481797],[-74.6624216,40.3481587],[-74.6624175,40.3481468],[-74.6622983,40.3481811],[-74.6623075,40.3481974],[-74.66232,40.3482195],[-74.6623555,40.3482088],[-74.662489,40.3484045],[-74.6624568,40.3484137],[-74.6624461,40.3483933],[-74.6620398,40.3485139],[-74.6619323,40.3482868],[-74.66189,40.3482017],[-74.6618667,40.3481623],[-74.6617434,40.3481956],[-74.6617514,40.3482124],[-74.6616839,40.3482296],[-74.6617218,40.3483038],[-74.661813,40.3482758],[-74.6619156,40.3484792],[-74.6618359,40.3485027],[-74.6618654,40.3485619],[-74.6618899,40.3485553]]]}},{"type":"Feature","id":"way/210145999","properties":{"@id":"way/210145999","building":"dormitory","name":"Studio 34","queryname":"Studio34ButlerEmporium","density":studio,"lat":40.344002,"long":-74.655660,"max":100,"time":time,"hours":{0:"00:00-03:30, 20:00-23:59",1:"00:00-03:00, 20:00-23:59",2:"00:00-03:00, 20:00-23:59",3:"00:00-03:00, 20:00-23:59",4:"00:00-03:00, 20:00-23:59",5:"00:00-03:30, 20:00-23:59",6:"00:00-03:30, 20:00-23:59"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6563745,40.3442905],[-74.6563315,40.3442169],[-74.6560472,40.3443314],[-74.6558648,40.3441024],[-74.6558219,40.3441351],[-74.6557576,40.3440329],[-74.6561116,40.3438775],[-74.6560419,40.343759],[-74.6555644,40.3439757],[-74.6558952,40.3443924],[-74.6559668,40.3444826],[-74.6563745,40.3442905]]]}},{"type":"Feature","id":"way/210145781","properties":{"@id":"way/210145781","building":"dormitory","name":"Whitman Dining Hall","queryname":"WhitmanCollege","density":whitman,"lat":40.344184,"long":-74.657646,"max":355,"time":time,"hours":{0:"10:00-14:00, 17:00-20:00",1:"08:00-11:00, 11:30-14:00, 17:00-20:00",2:"08:00-11:00, 11:30-14:00, 17:00-20:00",3:"08:00-11:00, 11:30-14:00, 17:00-20:00",4:"08:00-11:00, 11:30-14:00, 17:00-20:00",5:"08:00-11:00, 11:30-14:00, 17:00-20:00",6:"10:00-14:00, 17:00-20:00"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6575171,40.3440452],[-74.6575546,40.3441188],[-74.6575171,40.3441392],[-74.6574903,40.3442128],[-74.6575224,40.3442659],[-74.6575707,40.3442823],[-74.6575976,40.3443355],[-74.6576673,40.3443232],[-74.6578389,40.3442741],[-74.6578014,40.3442046],[-74.6581984,40.3440942],[-74.6583754,40.3445358],[-74.6585095,40.344499],[-74.6583539,40.3440983],[-74.6583861,40.3440574],[-74.658488,40.3440288],[-74.6584666,40.3440002],[-74.6585953,40.3439634],[-74.6585685,40.3439021],[-74.6584934,40.3439205],[-74.6584612,40.3438571],[-74.6585417,40.3438305],[-74.6585041,40.343761],[-74.6584746,40.3437692],[-74.6582788,40.3433542],[-74.6574715,40.3435668],[-74.6574339,40.3434952],[-74.6570289,40.3436199],[-74.6570423,40.3436567],[-74.6569941,40.3436792],[-74.6570423,40.3437692],[-74.6571201,40.3437467],[-74.6571013,40.343714],[-74.6571346,40.3437034],[-74.657332,40.3436404],[-74.6574527,40.3438571],[-74.6575976,40.3438121],[-74.6575385,40.3436915],[-74.6581351,40.3435286],[-74.6581823,40.3435157],[-74.6583808,40.3439348],[-74.6577665,40.3441085],[-74.6576941,40.3439879],[-74.6575171,40.3440452]]]}},{"type":"Feature","id":"way/40718016","properties":{"@id":"way/40718016","building":"university","name":"Woodrow Wilson Cafe","queryname":"WoodrowWilsonCafe","density":woodywoo,"lat":40.348393,"long":-74.654712,"max":110,"time":time,"hours":{0:"CLOSED",1:"09:00-15:00",2:"09:00-15:00",3:"09:00-15:00",4:"09:00-15:00",5:"09:00-14:00",6:"CLOSED"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6551337,40.3483915],[-74.655097,40.3483445],[-74.6550387,40.3482699],[-74.6549412,40.3481451],[-74.654283,40.3484453],[-74.6544809,40.3486941],[-74.6551337,40.3483915]]]}},{"type":"Feature","id":"way/27341417","properties":{"@id":"way/27341417","building":"yes","leisure":"sports_centre","name":"Dillon Gym","queryname":"DillonGym","density":dillon,"lat":40.345611,"long":-74.658797,"max":3665, "time": time, "hours":{0:"00:00-01:00, 08:00-23:59",1:"00:00-01:00, 06:30-23:59",2:"00:00-01:00, 06:30-23:59",3:"00:00-01:00, 06:30-23:59",4:"00:00-01:00, 06:30-23:59",5:"00:00-01:00, 06:30-23:59",6:"00:00-01:00, 08:00-23:59"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6588761,40.3449764],[-74.6587394,40.3450124],[-74.6588541,40.3452652],[-74.6580229,40.3454842],[-74.6580752,40.3455993],[-74.6584226,40.3455078],[-74.6584742,40.3456216],[-74.658461,40.3456371],[-74.6584666,40.3456502],[-74.658484,40.3456601],[-74.6585038,40.3457056],[-74.658497,40.3457188],[-74.6585026,40.3457326],[-74.65852,40.3457394],[-74.6585409,40.3457345],[-74.6585494,40.3457188],[-74.6586053,40.3457042],[-74.658624,40.3457113],[-74.6586493,40.3457048],[-74.6588007,40.3460395],[-74.6587692,40.3460478],[-74.6588338,40.3461905],[-74.6588491,40.3461865],[-74.6588668,40.3462257],[-74.6592581,40.3461226],[-74.6592536,40.3461126],[-74.6592406,40.3460851],[-74.6592591,40.3460801],[-74.6592474,40.3460553],[-74.6591933,40.3459367],[-74.6591602,40.3459455],[-74.6591029,40.3458198],[-74.6591684,40.3458025],[-74.6591484,40.3457586],[-74.6590861,40.345775],[-74.658972,40.3455243],[-74.6591375,40.3454806],[-74.6590742,40.3453414],[-74.6590452,40.3453491],[-74.6588761,40.3449764]]]}},{"type":"Feature","id":"way/27341305","properties":{"@id":"way/27341305","addr:housenumber":"1","addr:street":"Washington Road","amenity":"library","building":"yes","name":"Firestone Library","queryname":"FirestoneLibrary","operator":"Princeton University","wheelchair":"yes","density":firestone,"lat":40.349450,"long":-74.657430,"max":3592,"time":time,"hours":{0:"09:00-23:45",1:"08:00-23:45",2:"08:00-23:45",3:"08:00-23:45",4:"08:00-23:45",5:"08:00-23:45",6:"09:00-23:45"}},"geometry":{"type":"Polygon","coordinates":[[[-74.6581293,40.3494695],[-74.6580243,40.3492453],[-74.6580587,40.349236],[-74.6580406,40.3491975],[-74.6580095,40.349206],[-74.6579775,40.3491384],[-74.657672,40.3492223],[-74.6576366,40.3491476],[-74.6575817,40.3491626],[-74.6575672,40.3491319],[-74.6574172,40.3491732],[-74.657411,40.3491602],[-74.6573801,40.3491687],[-74.6573344,40.3490728],[-74.657008,40.3491632],[-74.657072,40.3492974],[-74.6569902,40.3493201],[-74.6569941,40.3493023],[-74.6569467,40.3492594],[-74.656874,40.3492638],[-74.6568422,40.3493201],[-74.6568869,40.3493657],[-74.6569063,40.3493662],[-74.6569233,40.3494033],[-74.6567993,40.3494364],[-74.6568623,40.3495735],[-74.6568398,40.3495795],[-74.6568748,40.3496555],[-74.6568526,40.3496851],[-74.656866,40.349715],[-74.6569003,40.3497262],[-74.6569229,40.3497198],[-74.656987,40.3498521],[-74.6571676,40.3498013],[-74.6571989,40.3498662],[-74.6569755,40.3499249],[-74.6570091,40.3499937],[-74.6570803,40.350086],[-74.6571023,40.3500796],[-74.6571112,40.3500971],[-74.6570916,40.3501122],[-74.6570822,40.3501299],[-74.6570861,40.3501461],[-74.6571033,40.3501578],[-74.6571254,40.3501618],[-74.6571453,40.3501589],[-74.6571586,40.3501466],[-74.6571616,40.3501275],[-74.6571857,40.350121],[-74.6571951,40.3501411],[-74.6578749,40.3499575],[-74.6578583,40.3499218],[-74.6577869,40.3499411],[-74.6577622,40.3498881],[-74.657887,40.3498543],[-74.657842,40.3497579],[-74.6577143,40.3497925],[-74.6576599,40.3496762],[-74.6578511,40.3496243],[-74.6578183,40.349554],[-74.6581293,40.3494695]]]}}]};
			return data;
			}
			 
			// get traffic for each building
			function getTrafficForBld(givenBuilding) {
				var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
				var times = ["T0000", "T0030", "T0100", "T0130", "T0200", "T0230", "T0300", "T0330", "T0400", "T0430", "T0500", "T0530", "T0600", "T0630", "T0700", "T0730", "T0800", "T0830", "T0900", "T0930", "T1000", "T1030", "T1100", "T1130", "T1200", "T1230", "T1300", "T1330", "T1400", "T1430", "T1500", "T1530", "T1600", "T1630", "T1700", "T1730", "T1800", "T1830", "T1900", "T1930", "T2000", "T2030", "T2100", "T2130", "T2200", "T2230", "T2300", "T2330"]
				var traffics = [];
				var counter = 0;
				
				for (i = 0; i < 7; i++) {
					for (j = 0; j < 48; j++) {
						// get traffic for building
						var b = jsTraffic[givenBuilding][i];
						var t;
						if (typeof(b) == 'undefined') {
							t = 0;
						}
						else {
							t = jsTraffic[givenBuilding][i][j];
							if (typeof(t) == 'undefined') {
								t = 0;
							}
						} 
						traffics[counter] = t;
						counter++;
					}
				}
				return traffics;
			}
			
            // load map
            var campusMap = L.tileLayer('https://api.mapbox.com/styles/v1/waitlessprinceton/cj19oscmj00582tqnyb4sabtq/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoid2FpdGxlc3NwcmluY2V0b24iLCJhIjoiY2oweTF2ZG5rMDFqZjMzbzJnbWJ1MGxmcCJ9.M-_AnWBdd7urxxR2Ks-iUA', {
            		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
					maxZoom: 18,
					minZoom: 16,
            });
            var mymap = L.map('mapid', {
            	center: [40.345548, -74.657915],
            	zoom: 16,
            	layers: [campusMap]
            });

            // create geojson variable for current traffic
            var currentTime = getNearestHalfHourTimeString();
            var currentData = getTrafficAtTime(currentTime);
            var gjCurrent = L.geoJson(currentData, {style: style, onEachFeature: onEachFeature});
            // var timeString = '2017-05-02 ' + currentTime[1:3] + ':' + currentTime[3:5] + ':00+01';
            // var gjCurrent = L.geoJson(currentData, {style: style, onEachFeature: onEachFeature, time: timeString});
//             gjCurrent.addTo(mymap);
            
			// load hover box
			var info = L.control({position: 'topright'});
			info.onAdd = function(map) {
				this._div = L.DomUtil.create('div', 'info');
				this.update();
				return this._div;
			};
			info.update = function(props) {
				//if (isClosed(props)) {
				//	this._div.innerHTML = '<h4>Campus Building Traffic</h4>' + (props ? '<b>' + props.name + '</b><br />' + 'Closed': 'Hover over a building');
				//}
				//else {
				//if (props) {
					//var num = props.density;
					//var d;
					//if (num == -1) {
					//	d = "Closed";
					//}
				//	else {
					//	d = num + " people";
					//}
				//}
				//this._div.innerHTML = '<h4>Campus Building Traffic</h4>' + (props ? '<b>' + props.name + '</b><br />' + d : 'Hover over a building');
				this._div.innerHTML = '<h4>Campus Building Traffic</h4>' + (props ? '<b>' + props.name + '</b><br />' + props.density + ' people': 'Hover over a building');
				//}
			};
			info.addTo(mymap);
			
			slider
			var gj0000 = L.geoJson(getTrafficAtTime("T0000"), {style: style, onEachFeature: onEachFeature, time: "12:00 AM"});
			var gj0030 = L.geoJson(getTrafficAtTime("T0030"), {style: style, onEachFeature: onEachFeature, time: "12:30 AM"});
			var gj0100 = L.geoJson(getTrafficAtTime("T0100"), {style: style, onEachFeature: onEachFeature, time: "01:00 AM"});
			var gj0130 = L.geoJson(getTrafficAtTime("T0130"), {style: style, onEachFeature: onEachFeature, time: "01:30 AM"});
			var gj0200 = L.geoJson(getTrafficAtTime("T0200"), {style: style, onEachFeature: onEachFeature, time: "02:00 AM"});
			var gj0230 = L.geoJson(getTrafficAtTime("T0230"), {style: style, onEachFeature: onEachFeature, time: "02:30 AM"});
			var gj0300 = L.geoJson(getTrafficAtTime("T0300"), {style: style, onEachFeature: onEachFeature, time: "03:00 AM"});
			var gj0330 = L.geoJson(getTrafficAtTime("T0330"), {style: style, onEachFeature: onEachFeature, time: "03:30 AM"});
			var gj0400 = L.geoJson(getTrafficAtTime("T0400"), {style: style, onEachFeature: onEachFeature, time: "04:00 AM"});
			var gj0430 = L.geoJson(getTrafficAtTime("T0430"), {style: style, onEachFeature: onEachFeature, time: "04:30 AM"});
			var gj0500 = L.geoJson(getTrafficAtTime("T0500"), {style: style, onEachFeature: onEachFeature, time: "05:00 AM"});
			var gj0530 = L.geoJson(getTrafficAtTime("T0530"), {style: style, onEachFeature: onEachFeature, time: "05:30 AM"});
			var gj0600 = L.geoJson(getTrafficAtTime("T0600"), {style: style, onEachFeature: onEachFeature, time: "06:00 AM"});
			var gj0630 = L.geoJson(getTrafficAtTime("T0630"), {style: style, onEachFeature: onEachFeature, time: "06:30 AM"});
			var gj0700 = L.geoJson(getTrafficAtTime("T0700"), {style: style, onEachFeature: onEachFeature, time: "07:00 AM"});
			var gj0730 = L.geoJson(getTrafficAtTime("T0730"), {style: style, onEachFeature: onEachFeature, time: "07:30 AM"});
			var gj0800 = L.geoJson(getTrafficAtTime("T0800"), {style: style, onEachFeature: onEachFeature, time: "08:00 AM"});
			var gj0830 = L.geoJson(getTrafficAtTime("T0830"), {style: style, onEachFeature: onEachFeature, time: "08:30 AM"});
			var gj0900 = L.geoJson(getTrafficAtTime("T0900"), {style: style, onEachFeature: onEachFeature, time: "09:00 AM"});
			var gj0930 = L.geoJson(getTrafficAtTime("T0930"), {style: style, onEachFeature: onEachFeature, time: "09:30 AM"});
			var gj1000 = L.geoJson(getTrafficAtTime("T1000"), {style: style, onEachFeature: onEachFeature, time: "10:00 AM"});
			var gj1030 = L.geoJson(getTrafficAtTime("T1030"), {style: style, onEachFeature: onEachFeature, time: "10:30 AM"});
			var gj1100 = L.geoJson(getTrafficAtTime("T1100"), {style: style, onEachFeature: onEachFeature, time: "11:00 AM"});
			var gj1130 = L.geoJson(getTrafficAtTime("T1130"), {style: style, onEachFeature: onEachFeature, time: "11:30 AM"});
			var gj1200 = L.geoJson(getTrafficAtTime("T1200"), {style: style, onEachFeature: onEachFeature, time: "12:00 PM"});
			var gj1230 = L.geoJson(getTrafficAtTime("T1230"), {style: style, onEachFeature: onEachFeature, time: "12:30 PM"});
			var gj1300 = L.geoJson(getTrafficAtTime("T1300"), {style: style, onEachFeature: onEachFeature, time: "01:00 PM"});
			var gj1330 = L.geoJson(getTrafficAtTime("T1330"), {style: style, onEachFeature: onEachFeature, time: "01:30 PM"});
			var gj1400 = L.geoJson(getTrafficAtTime("T1400"), {style: style, onEachFeature: onEachFeature, time: "02:00 PM"});
			var gj1430 = L.geoJson(getTrafficAtTime("T1430"), {style: style, onEachFeature: onEachFeature, time: "02:30 PM"});
			var gj1500 = L.geoJson(getTrafficAtTime("T1500"), {style: style, onEachFeature: onEachFeature, time: "03:00 PM"});
			var gj1530 = L.geoJson(getTrafficAtTime("T1530"), {style: style, onEachFeature: onEachFeature, time: "03:30 PM"});
			var gj1600 = L.geoJson(getTrafficAtTime("T1600"), {style: style, onEachFeature: onEachFeature, time: "04:00 PM"});
			var gj1630 = L.geoJson(getTrafficAtTime("T1630"), {style: style, onEachFeature: onEachFeature, time: "04:30 PM"});
			var gj1700 = L.geoJson(getTrafficAtTime("T1700"), {style: style, onEachFeature: onEachFeature, time: "05:00 PM"});
			var gj1730 = L.geoJson(getTrafficAtTime("T1730"), {style: style, onEachFeature: onEachFeature, time: "05:30 PM"});
			var gj1800 = L.geoJson(getTrafficAtTime("T1800"), {style: style, onEachFeature: onEachFeature, time: "06:00 PM"});
			var gj1830 = L.geoJson(getTrafficAtTime("T1830"), {style: style, onEachFeature: onEachFeature, time: "06:30 PM"});
			var gj1900 = L.geoJson(getTrafficAtTime("T1900"), {style: style, onEachFeature: onEachFeature, time: "07:00 PM"});
			var gj1930 = L.geoJson(getTrafficAtTime("T1930"), {style: style, onEachFeature: onEachFeature, time: "07:30 PM"});
			var gj2000 = L.geoJson(getTrafficAtTime("T2000"), {style: style, onEachFeature: onEachFeature, time: "08:00 PM"});
			var gj2030 = L.geoJson(getTrafficAtTime("T2030"), {style: style, onEachFeature: onEachFeature, time: "08:30 PM"});
			var gj2100 = L.geoJson(getTrafficAtTime("T2100"), {style: style, onEachFeature: onEachFeature, time: "09:00 PM"});
			var gj2130 = L.geoJson(getTrafficAtTime("T2130"), {style: style, onEachFeature: onEachFeature, time: "09:30 PM"});
			var gj2200 = L.geoJson(getTrafficAtTime("T2200"), {style: style, onEachFeature: onEachFeature, time: "10:00 PM"});
			var gj2230 = L.geoJson(getTrafficAtTime("T2230"), {style: style, onEachFeature: onEachFeature, time: "10:30 PM"});
			var gj2300 = L.geoJson(getTrafficAtTime("T2300"), {style: style, onEachFeature: onEachFeature, time: "11:00 PM"});
			var gj2330 = L.geoJson(getTrafficAtTime("T2330"), {style: style, onEachFeature: onEachFeature, time: "11:30 PM"});
			 
// 			var gj0000 = L.geoJson(getTrafficAtTime("T0000"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 00:00:00+01"});
// 			var gj0030 = L.geoJson(getTrafficAtTime("T0030"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 00:30:00+01"});
// 			var gj0100 = L.geoJson(getTrafficAtTime("T0100"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 01:00:00+01"});
// 			var gj0130 = L.geoJson(getTrafficAtTime("T0130"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 01:30:00+01"});
// 			var gj0200 = L.geoJson(getTrafficAtTime("T0200"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 02:00:00+01"});
// 			var gj0230 = L.geoJson(getTrafficAtTime("T0230"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 02:30:00+01"});
// 			var gj0300 = L.geoJson(getTrafficAtTime("T0300"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 03:00:00+01"});
// 			var gj0330 = L.geoJson(getTrafficAtTime("T0330"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 03:30:00+01"});
// 			var gj0400 = L.geoJson(getTrafficAtTime("T0400"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 04:00:00+01"});
// 			var gj0430 = L.geoJson(getTrafficAtTime("T0430"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 04:30:00+01"});
// 			var gj0500 = L.geoJson(getTrafficAtTime("T0500"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 05:00:00+01"});
// 			var gj0530 = L.geoJson(getTrafficAtTime("T0530"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 05:30:00+01"});
// 			var gj0600 = L.geoJson(getTrafficAtTime("T0600"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 06:00:00+01"});
// 			var gj0630 = L.geoJson(getTrafficAtTime("T0630"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 06:30:00+01"});
// 			var gj0700 = L.geoJson(getTrafficAtTime("T0700"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 07:00:00+01"});
// 			var gj0730 = L.geoJson(getTrafficAtTime("T0730"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 07:30:00+01"});
// 			var gj0800 = L.geoJson(getTrafficAtTime("T0800"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 08:00:00+01"});
// 			var gj0830 = L.geoJson(getTrafficAtTime("T0830"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 08:30:00+01"});
// 			var gj0900 = L.geoJson(getTrafficAtTime("T0900"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 09:00:00+01"});
// 			var gj0930 = L.geoJson(getTrafficAtTime("T0930"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 09:30:00+01"});
// 			var gj1000 = L.geoJson(getTrafficAtTime("T1000"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 10:00:00+01"});
// 			var gj1030 = L.geoJson(getTrafficAtTime("T1030"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 10:30:00+01"});
// 			var gj1100 = L.geoJson(getTrafficAtTime("T1100"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 11:00:00+01"});
// 			var gj1130 = L.geoJson(getTrafficAtTime("T1130"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 11:30:00+01"});
// 			var gj1200 = L.geoJson(getTrafficAtTime("T1200"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 12:00:00+01"});
// 			var gj1230 = L.geoJson(getTrafficAtTime("T1230"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 12:30:00+01"});
// 			var gj1300 = L.geoJson(getTrafficAtTime("T1300"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 13:00:00+01"});
// 			var gj1330 = L.geoJson(getTrafficAtTime("T1330"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 13:30:00+01"});
// 			var gj1400 = L.geoJson(getTrafficAtTime("T1400"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 14:00:00+01"});
// 			var gj1430 = L.geoJson(getTrafficAtTime("T1430"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 14:30:00+01"});
// 			var gj1500 = L.geoJson(getTrafficAtTime("T1500"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 15:00:00+01"});
// 			var gj1530 = L.geoJson(getTrafficAtTime("T1530"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 15:30:00+01"});
// 			var gj1600 = L.geoJson(getTrafficAtTime("T1600"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 16:00:00+01"});
// 			var gj1630 = L.geoJson(getTrafficAtTime("T1630"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 16:30:00+01"});
// 			var gj1700 = L.geoJson(getTrafficAtTime("T1700"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 17:00:00+01"});
// 			var gj1730 = L.geoJson(getTrafficAtTime("T1730"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 17:30:00+01"});
// 			var gj1800 = L.geoJson(getTrafficAtTime("T1800"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 18:00:00+01"});
// 			var gj1830 = L.geoJson(getTrafficAtTime("T1830"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 18:30:00+01"});
// 			var gj1900 = L.geoJson(getTrafficAtTime("T1900"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 19:00:00+01"});
// 			var gj1930 = L.geoJson(getTrafficAtTime("T1930"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 19:30:00+01"});
// 			var gj2000 = L.geoJson(getTrafficAtTime("T2000"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 20:00:00+01"});
// 			var gj2030 = L.geoJson(getTrafficAtTime("T2030"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 20:30:00+01"});
// 			var gj2100 = L.geoJson(getTrafficAtTime("T2100"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 21:00:00+01"});
// 			var gj2130 = L.geoJson(getTrafficAtTime("T2130"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 21:30:00+01"});
// 			var gj2200 = L.geoJson(getTrafficAtTime("T2200"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 22:00:00+01"});
// 			var gj2230 = L.geoJson(getTrafficAtTime("T2230"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 22:30:00+01"});
// 			var gj2300 = L.geoJson(getTrafficAtTime("T2300"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 23:00:00+01"});
// 			var gj2330 = L.geoJson(getTrafficAtTime("T2330"), {style: style, onEachFeature: onEachFeature, time: "2017-04-08 23:30:00+01"});

			var dctTime = {	'T0000':0, 'T0030':1, 'T0100':2, 'T0130':3, 'T0200':4, 
			'T0230':5, 'T0300':6, 'T0330':7, 'T0400':8, 'T0430':9, 
			'T0500':10, 'T0530':11, 'T0600':12, 'T0630':13, 'T0700':14,
			'T0730':15, 'T0800':16, 'T0830':17, 'T0900':18, 'T0930':19, 
			'T1000':20, 'T1030':21, 'T1100':22, 'T1130':23, 'T1200':24, 
			'T1230':25, 'T1300':26, 'T1330':27, 'T1400':28, 'T1430':29, 
			'T1500':30, 'T1530':31, 'T1600':32, 'T1630':33, 'T1700':34,
			'T1730':35, 'T1800':36, 'T1830':37, 'T1900':38, 'T1930':39, 
			'T2000':40, 'T2030':41, 'T2100':42, 'T2130':43, 'T2200':44, 
			'T2230':45, 'T2300':46, 'T2330':47}
			
			layerGroup = L.layerGroup([gj0000, gj0030, gj0100, gj0130, gj0200, gj0230, gj0300, gj0330, gj0400, gj0430, gj0500, gj0530, gj0600, gj0630, gj0700, gj0730, gj0800, gj0830, gj0900, gj0930, gj1000, gj1030, gj1100, gj1130, gj1200, gj1230, gj1300, gj1330, gj1400, gj1430, gj1500, gj1530, gj1600, gj1630, gj1700, gj1730, gj1800, gj1830, gj1900, gj1930, gj2000, gj2030, gj2100, gj2130, gj2200, gj2230, gj2300, gj2330]);
			var sliderControl = L.control.sliderControl({position: "topright", layer:layerGroup, value:dctTime[currentTime], follow:1});
 			//$("#sliderControl").slider('value',dctTime[currentTime]);
			mymap.addControl(sliderControl);
 			//sliderControl.startSlider(dctTime[currentTime]);
			sliderControl.startSlider();
			gjCurrent.addTo(mymap);
			 
			// load legend
			var legend = L.control({position: 'bottomright'});
			legend.onAdd = function(map) {
				var div = L.DomUtil.create('div', 'info legend'),
				grades = [0, 5, 10, 15, 20],
				labels = [];
				for (var i = 0; i < grades.length; i++) {
					div.innerHTML += '<i style="background:' + color(grades[i] + 1) + '"></i> ' + grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '%<br>' : '+%');
				}
				return div;
			};
			legend.addTo(mymap);
			 
			 // unfiltered style
			function style(feature) {
				var percentFull = feature.properties.density/feature.properties.max * 100;
				return {
					fillColor: getColor(feature, percentFull),
					weight: 2,
					opacity: 1,
					color: 'white',
					dashArray: '3',
					fillOpacity: 1
				};
			}
			// assign color based on density
			function getColor(feature, percentFull) {
				var closed = isClosed(feature.properties);
				if (closed) {return '#A0A0A0';}
				return percentFull > 20 ? '#E50001' :
				percentFull > 15  ? '#DB6500' :
				percentFull > 10  ? '#D2C400' :
				percentFull > 5  ? '#76C800' :
				'#16BF00';
			}
			 
			 function isClosed(props) {
				var d = new Date(); 
				var curDay = d.getDay();
				var openTimes = props.hours[curDay];
				if (openTimes == "CLOSED") {
				  return true;
				}
				var curTime = props.time;
				var res = openTimes.split(", ");
				for (i in res) {
				  var start = res[i].substring(0,5);
				  var end = res[i].substring(6);
				  if (end <= start) {end = (parseInt(end.substring(0,3)) + 24) + ":" + end.substring(3);} 
				  if (start <= curTime && curTime <= end) {return false;}
				}
				return true;
			 }
			
			// color function for legend
			function color(percentFull) {
			return percentFull > 20 ? '#E50001' :
			percentFull > 15  ? '#DB6500' :
			percentFull > 10  ? '#D2C400' :
			percentFull > 5  ? '#76C800' :
			'#16BF00';
			}
			 
			// add listeners
		      function onEachFeature(feature, layer) {
			layer.on({
			  mouseover: highlightFeature,
			  mouseout: resetHighlight,
			  click: showHistory
			});
		      }
			 
		      // highlight
		      function highlightFeature(e) {
			var layer = e.target;
			layer.setStyle({
			  weight: 3,
			  color: '#666',
			  dashArray: '',
			  fillOpacity: 1.4
			});
			if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			  layer.bringToFront();
			}
			info.update(layer.feature.properties);
     			 }
			 
			// refresh the page on the half hour
			setInterval(refresh, 60000);
			function refresh() {
				var d = new Date(); 
				var m = d.getMinutes();
				if (m == 0 || m == 30) {
					location.reload(true);
					//layer.setStyle({
					//  fillColor: getColor(feature, percentFull),
					//});
				}
			}

			// unhighlight
			function resetHighlight(e) {
				gjCurrent.resetStyle(e.target);
				gj0000.resetStyle(e.target);
				gj0030.resetStyle(e.target);
				gj0100.resetStyle(e.target);
				gj0130.resetStyle(e.target);
				gj0200.resetStyle(e.target);
				gj0230.resetStyle(e.target);
				gj0300.resetStyle(e.target);
				gj0330.resetStyle(e.target);
				gj0400.resetStyle(e.target);
				gj0430.resetStyle(e.target);
				gj0500.resetStyle(e.target);
				gj0530.resetStyle(e.target);
				gj0600.resetStyle(e.target);
				gj0630.resetStyle(e.target);
				gj0700.resetStyle(e.target);
				gj0730.resetStyle(e.target);
				gj0800.resetStyle(e.target);
				gj0830.resetStyle(e.target);
				gj0900.resetStyle(e.target);
				gj0930.resetStyle(e.target);
				gj1000.resetStyle(e.target);
				gj1030.resetStyle(e.target);
				gj1100.resetStyle(e.target);
				gj1130.resetStyle(e.target);
				gj1200.resetStyle(e.target);
				gj1230.resetStyle(e.target);
				gj1300.resetStyle(e.target);
				gj1330.resetStyle(e.target);
				gj1400.resetStyle(e.target);
				gj1430.resetStyle(e.target);
				gj1500.resetStyle(e.target);
				gj1530.resetStyle(e.target);
				gj1600.resetStyle(e.target);
				gj1630.resetStyle(e.target);
				gj1700.resetStyle(e.target);
				gj1730.resetStyle(e.target);
				gj1800.resetStyle(e.target);
				gj1830.resetStyle(e.target);
				gj1900.resetStyle(e.target);
				gj1930.resetStyle(e.target);
				gj2000.resetStyle(e.target);
				gj2030.resetStyle(e.target);
				gj2100.resetStyle(e.target);
				gj2130.resetStyle(e.target);
				gj2200.resetStyle(e.target);
				gj2230.resetStyle(e.target);
				gj2300.resetStyle(e.target);
				gj2330.resetStyle(e.target);
				info.update();
			}
			// draw chart
			function drawChart(elem, name, queryname) {
				var traffic = getTrafficForBld(queryname);
				var times = ['12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '0:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30', '5:00', '5:30', '6:00', '6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30'];
				var trafficPairings = [];
				trafficPairings[0] = ['Time', 'Traffic'];
				for (i = 1; i < 337; i++) {
					var traf = traffic[i];
					var time = times[i];
					var pair = [time, traf];
					trafficPairings[i] = pair;
				}
			
				var data = google.visualization.arrayToDataTable(trafficPairings);
				
		    	var options = {
		    		title: 'Daily Traffic - ' + name,
		    		colors:['#E50000'],
		      		curveType: 'function',
		      		legend: {position: 'none'},
		      		chartArea: {width: '85%', height: '80%'},
		      		vAxis: {
		      			viewWindowMode: 'explicit',
		      			viewWindow: {
		      				min: 0
		      			}
		      		}
		    	};
		    	var container = document.getElementById(elem);
		    	var chart = new google.visualization.LineChart(container);
		    	chart.draw(data, options);
		  	}
			// generate popup with chart
			function showHistory(e) {
				var options = {
					maxWidth: 500
				};
				var prop = e.target.feature.properties;
				var chartId = "curve_chart" + popupId;
				var popup = L.popup(options)
					.setLatLng([prop.lat,prop.long])
    				.setContent('<div id="' + chartId + '" style="width: 500px; height: 300px"></div>')
    				.openOn(mymap);
			popupId++;
    			drawChart(chartId, prop.name, prop.queryname);
			}
		</script>
	</body>	
</html>
